parameters:
  # If this is a new stable branch, change `publishTag` to `latest` when going stable
  publishTag: 'latest'

steps:
  - script: |
      yarn install
    displayName: Install npm dependencies

  - script: |
      node .ado/scripts/prepublish-check.mjs --tag ${{ parameters['publishTag'] }}
    displayName: Verify release config

  - script: |
      yarn nx release --dry-run
    displayName: Version and publish packages (dry run)
    condition: and(succeeded(), ne(variables['publish_react_native_macos'], '1'))

  - script: |
      yarn nx release --yes
    env:
      GITHUB_TOKEN: $(githubAuthToken)
      NODE_AUTH_TOKEN: $(npmAuthToken)
    displayName: Version and publish packages
    condition: and(succeeded(), eq(variables['publish_react_native_macos'], '1'))
