import*as e from"../../core/i18n/i18n.js";import*as t from"../../ui/legacy/legacy.js";import*as i from"../../core/sdk/sdk.js";import*as n from"../../third_party/react-devtools/react-devtools.js";import*as s from"../../core/common/common.js";import*as o from"../../models/workspace/workspace.js";import*as r from"../../models/bindings/bindings.js";import*as a from"../../models/logs/logs.js";import*as l from"../../core/host/host.js";import*as d from"../../models/react_native/react_native.js";class c extends i.SDKModel.SDKModel{static FUSEBOX_BINDING_NAMESPACE="react-devtools";#e;#t;#i=new Set;#n=!1;#s=!1;#o;#r;constructor(e){super(e),this.#e={listen:e=>(this.#i.add(e),()=>{this.#i.delete(e)}),send:(e,t)=>{this.#a({event:e,payload:t})}},this.#o=n.createBridge(this.#e),this.#r=n.createStore(this.#o);const t=e.model(d.ReactDevToolsBindingsModel.ReactDevToolsBindingsModel);if(null==t)throw new Error("Failed to construct ReactDevToolsModel: ReactDevToolsBindingsModel was null");this.#t=t,t.addEventListener("BackendExecutionContextCreated",this.#l,this),t.addEventListener("BackendExecutionContextUnavailable",this.#d,this),t.addEventListener("BackendExecutionContextDestroyed",this.#c,this),window.addEventListener("beforeunload",(()=>this.#o?.shutdown()))}async ensureInitialized(){if(!this.#n){this.#n=!0;try{const e=this.#t;await e.enable(),e.subscribeToDomainMessages(c.FUSEBOX_BINDING_NAMESPACE,(e=>this.#h(e))),await e.initializeDomain(c.FUSEBOX_BINDING_NAMESPACE),this.#s=!0,this.dispatchEventToListeners("InitializationCompleted")}catch(e){this.dispatchEventToListeners("InitializationFailed",e.message)}}}isInitialized(){return this.#s}getBridgeOrThrow(){if(null==this.#o)throw new Error("Failed to get bridge from ReactDevToolsModel: bridge was null");return this.#o}getStoreOrThrow(){if(null==this.#r)throw new Error("Failed to get store from ReactDevToolsModel: store was null");return this.#r}#h(e){if(e)for(const t of this.#i)t(e)}async#a(e){const t=this.#t;if(!t)throw new Error("Failed to send message from ReactDevToolsModel: ReactDevToolsBindingsModel was null");return t.sendMessage(c.FUSEBOX_BINDING_NAMESPACE,e)}#l(){const e=this.#t;if(!e)throw new Error("ReactDevToolsModel failed to handle BackendExecutionContextCreated event: ReactDevToolsBindingsModel was null");this.#o=n.createBridge(this.#e),this.#r=n.createStore(this.#o),e.isEnabled()?this.dispatchEventToListeners("InitializationCompleted"):this.ensureInitialized()}#d({data:e}){this.dispatchEventToListeners("InitializationFailed",e)}#c(){this.#o?.shutdown(),this.#o=null,this.#r=null,this.#i.clear(),this.dispatchEventToListeners("Destroyed")}}i.SDKModel.SDKModel.register(c,{capabilities:4,autostart:!1});var h=Object.freeze({__proto__:null,ReactDevToolsModel:c});const m={sendFeedback:"[FB-only] Send feedback"},u=e.i18n.registerUIStrings("panels/react_devtools/ReactDevToolsViewBase.ts",m),g=e.i18n.getLocalizedString.bind(void 0,u);function p(e,t){const{sourceURL:i,line:n,column:l}=t||e;!async function(e,t,i){const n=o.Workspace.WorkspaceImpl.instance().uiSourceCodeForURL(e);if(n){const e=await r.DebuggerWorkspaceBinding.DebuggerWorkspaceBinding.instance().normalizeUILocation(n.uiLocation(t,i));return void s.Revealer.reveal(e)}const l=r.ResourceUtils.resourceForURL(e);if(l)return void s.Revealer.reveal(l);const d=a.NetworkLog.NetworkLog.instance().requestForURL(e);if(!d)throw new Error("Could not find resource for "+e);s.Revealer.reveal(d)}(i,n-1,l-1)}class v extends t.View.SimpleView{#m;#u=null;constructor(e,t){super(t),this.#m=e,this.#g()}wasShown(){super.wasShown(),this.registerCSSFiles([n.CSS]),null==this.#u&&i.TargetManager.TargetManager.instance().observeModels(c,this)}modelAdded(e){this.#u=e,e.isInitialized()&&this.#p(),e.addEventListener("InitializationCompleted",this.#v,this),e.addEventListener("InitializationFailed",this.#w,this),e.addEventListener("Destroyed",this.#E,this),e.ensureInitialized()}modelRemoved(e){e.removeEventListener("InitializationCompleted",this.#v,this),e.removeEventListener("InitializationFailed",this.#w,this),e.removeEventListener("Destroyed",this.#E,this)}#v(){this.#p()}#w({data:e}){this.#b(e)}#E(){this.#g()}#p(){this.#f();const e=this.#u,t=window.matchMedia("(prefers-color-scheme: dark)").matches;("components"===this.#m?n.initializeComponents:n.initializeProfiler)(this.contentElement,{bridge:e.getBridgeOrThrow(),store:e.getStoreOrThrow(),theme:t?"dark":"light",canViewElementSourceFunction:()=>!0,viewElementSourceFunction:p})}#g(){this.#f();const e=document.createElement("div");e.setAttribute("style","display: flex; flex: 1; justify-content: center; align-items: center");const t=document.createElement("span");t.classList.add("spinner"),e.appendChild(t),this.contentElement.appendChild(e)}#b(e){this.#f();const i=document.createElement("div");i.setAttribute("style","display: flex; flex: 1; flex-direction: column; justify-content: center; align-items: center");const n=document.createElement("div");n.setAttribute("style","font-size: 3rem"),n.innerHTML="❗";const s=document.createElement("p");if(s.setAttribute("style","user-select: all"),s.innerHTML=e,i.appendChild(n),i.appendChild(s),this.contentElement.appendChild(i),globalThis.FB_ONLY__reactNativeFeedbackLink){const e=globalThis.FB_ONLY__reactNativeFeedbackLink,n=t.UIUtils.createTextButton(g(m.sendFeedback),(()=>{l.InspectorFrontendHost.InspectorFrontendHostInstance.openInNewTab(e)}),{className:"primary-button",jslogContext:"sendFeedback"});i.appendChild(n)}}#f(){this.contentElement.removeChildren()}}const w={title:"⚛️ Components (React DevTools)"},E=e.i18n.registerUIStrings("panels/react_devtools/ReactDevToolsComponentsView.ts",w),b=e.i18n.getLocalizedString.bind(void 0,E);var f=Object.freeze({__proto__:null,ReactDevToolsComponentsViewImpl:class extends v{constructor(){super("components",b(w.title))}}});const C={title:"⚛️ Profiler (React DevTools)"},D=e.i18n.registerUIStrings("panels/react_devtools/ReactDevToolsProfilerView.ts",C),T=e.i18n.getLocalizedString.bind(void 0,D);var I=Object.freeze({__proto__:null,ReactDevToolsProfilerViewImpl:class extends v{constructor(){super("profiler",T(C.title))}}});export{f as ReactDevToolsComponentsView,h as ReactDevToolsModel,I as ReactDevToolsProfilerView};
